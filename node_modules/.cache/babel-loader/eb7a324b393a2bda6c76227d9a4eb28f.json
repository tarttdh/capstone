{"ast":null,"code":"import _asyncToGenerator from\"/mnt/c/capstone/connect/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/mnt/c/capstone/connect/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/mnt/c/capstone/connect/node_modules/@babel/runtime/regenerator/index.js\";import{createContext,useState,useEffect}from'react';import jwt_decode from\"jwt-decode\";import{useNavigate}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";export var AuthContext=/*#__PURE__*/createContext();var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(JSON.parse(localStorage.getItem('authTokens'))||null),_useState2=_slicedToArray(_useState,2),authTokens=_useState2[0],setAuthTokens=_useState2[1];var _useState3=useState(function(){return localStorage.getItem('authTokens')?jwt_decode(localStorage.getItem('authTokens')):null;}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var history=useNavigate();var loginUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var response,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(\"executeddd\");e.preventDefault();_context.next=4;return fetch('http://127.0.0.1:8000/api/token/',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({'id':e.target.id.value,'username':e.target.username.value,'password':e.target.password.value})});case 4:response=_context.sent;_context.next=7;return response.json();case 7:data=_context.sent;console.log(data);if(response.status===200){setAuthTokens(data);setUser(jwt_decode(data.access));localStorage.setItem('authTokens',JSON.stringify(data));}else{alert('Something went wrong!');}case 10:case\"end\":return _context.stop();}}},_callee);}));return function loginUser(_x){return _ref2.apply(this,arguments);};}();var logoutUser=function logoutUser(){setAuthTokens(null);setUser(null);localStorage.removeItem('authTokens');};var updateToken=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch('http://127.0.0.1:8000/api/token/refresh/',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({'refresh':authTokens===null||authTokens===void 0?void 0:authTokens.refresh})});case 2:response=_context2.sent;_context2.next=5;return response.json();case 5:data=_context2.sent;if(response.status===200){setAuthTokens(data);setUser(jwt_decode(data.access));localStorage.setItem('authTokens',JSON.stringify(data));}else{logoutUser(false);}if(loading){setLoading(false);}case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function updateToken(){return _ref3.apply(this,arguments);};}();var contextData={user:user,authTokens:authTokens,loginUser:loginUser,logoutUser:logoutUser};useEffect(function(){if(loading){updateToken();}var fourMinutes=1000*60*4;var interval=setInterval(function(){if(authTokens){updateToken();}},fourMinutes);return function(){return clearInterval(interval);};},[authTokens,loading]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user:user,contextData:contextData,setAuthTokens:setAuthTokens,setUser:setUser},children:children});};export default AuthProvider;","map":{"version":3,"sources":["/mnt/c/capstone/connect/src/context/AuthContext.js"],"names":["createContext","useState","useEffect","jwt_decode","useNavigate","AuthContext","AuthProvider","children","JSON","parse","localStorage","getItem","authTokens","setAuthTokens","user","setUser","loading","setLoading","history","loginUser","e","console","log","preventDefault","fetch","method","headers","body","stringify","target","id","value","username","password","response","json","data","status","access","setItem","alert","logoutUser","removeItem","updateToken","refresh","contextData","fourMinutes","interval","setInterval","clearInterval"],"mappings":"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","sourcesContent":["import { createContext, useState, useEffect } from 'react'\nimport jwt_decode from \"jwt-decode\";\nimport { useNavigate } from 'react-router-dom'\n\nexport const AuthContext = createContext()\n\nconst AuthProvider = ({children}) => {\n    let [authTokens, setAuthTokens] = useState(JSON.parse(localStorage.getItem('authTokens')) || null)\n    let [user, setUser] = useState(()=> localStorage.getItem('authTokens') ? jwt_decode(localStorage.getItem('authTokens')) : null)\n    let [loading, setLoading] = useState(true)\n\n    const history = useNavigate()\n\n    let loginUser = async (e )=> {\n        console.log(\"executeddd\")\n        e.preventDefault()\n        let response = await fetch('http://127.0.0.1:8000/api/token/', {\n            method:'POST',\n            headers:{\n                'Content-Type':'application/json'\n            },\n            body:JSON.stringify({'id': e.target.id.value, 'username':e.target.username.value, 'password':e.target.password.value})\n        })\n        let data = await response.json()\n        console.log(data)\n        if(response.status === 200){\n            setAuthTokens(data)\n            setUser(jwt_decode(data.access))\n            localStorage.setItem('authTokens', JSON.stringify(data))\n            \n        }else{\n            alert('Something went wrong!')\n        }\n    }\n\n    let logoutUser = () => {\n        setAuthTokens(null)\n        setUser(null)\n        localStorage.removeItem('authTokens')\n    \n    }\n\n    let updateToken = async ()=> {\n\n        let response = await fetch('http://127.0.0.1:8000/api/token/refresh/', {\n            method:'POST',\n            headers:{\n                'Content-Type':'application/json'\n            },\n            body:JSON.stringify({'refresh':authTokens?.refresh})\n        })\n\n        let data = await response.json()\n        \n        if (response.status === 200){\n            setAuthTokens(data)\n            setUser(jwt_decode(data.access))\n            localStorage.setItem('authTokens', JSON.stringify(data))\n        }else{\n            logoutUser(false)\n        }\n\n        if(loading){\n            setLoading(false)\n        }\n    }\n\n    let contextData = {\n        user:user,\n        authTokens:authTokens,\n        loginUser:loginUser,\n        logoutUser:logoutUser,\n    }\n\n\n    useEffect(()=> {\n\n        if(loading){\n            updateToken()\n        }\n\n        let fourMinutes = 1000 * 60 * 4\n\n        let interval =  setInterval(()=> {\n            if(authTokens){\n                updateToken()\n            }\n        }, fourMinutes)\n        return ()=> clearInterval(interval)\n\n    }, [authTokens, loading])\n\n    return(\n        <AuthContext.Provider value={{user, contextData, setAuthTokens, setUser}} >\n            {children}\n        </AuthContext.Provider>\n    )\n}\n\nexport default AuthProvider;\n"]},"metadata":{},"sourceType":"module"}